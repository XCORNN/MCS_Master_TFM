# Instalación de SQL Server Express
wget -qO- https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -
sudo add-apt-repository "$(wget -qO- https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2019.list)"
sudo apt-get update
sudo apt-get install -y mssql-server
sudo /opt/mssql/bin/mssql-conf setup

# Instalación de herramientas de línea de comandos de SQL Server
curl -s https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -
sudo add-apt-repository "$(wget -qO- https://packages.microsoft.com/config/ubuntu/20.04/prod.list)"
sudo apt-get update
sudo apt-get install -y mssql-tools unixodbc-dev
echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bash_profile
echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc
source ~/.bashrc

# Creación de la base de datos y usuario
sqlcmd -S localhost -U SA -P "$DB_PASSWORD" -Q "CREATE DATABASE $DB_NAME;"
sqlcmd -S localhost -U SA -P "$DB_PASSWORD" -Q "CREATE LOGIN $DB_USER WITH PASSWORD = '$DB_PASSWORD';"
sqlcmd -S localhost -U SA -P "$DB_PASSWORD" -Q "USE $DB_NAME; CREATE USER $DB_USER FOR LOGIN $DB_USER; EXEC sp_addrolemember 'db_owner', '$DB_USER';"
